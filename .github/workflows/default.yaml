name: Build, Test, Push

on:
  schedule:
    - cron: '0 10 * * 0' # everyday sunday at 10am
  push:
    branches:
      - master
      - develop
      - feature/*
    tags:
      - 'v*.*.*'
  workflow_dispatch: # Allow manually triggering a build

defaults:
  run:
    shell: bash

env:
  DOCKSAL_VERSION: develop
  # Setting these while testing locally may result in data loss, so only use in CI.
  PROJECT_INACTIVITY_TIMEOUT: 30s
  PROJECT_DANGLING_TIMEOUT: 60s
  DOCKSAL_DNS_DISABLED: 1
  DOCKSAL_DNS_DOMAIN: docksal.site

jobs:
  build:
    name: Build
    runs-on: ubuntu-20.04
    strategy:
      fail-fast: false

    steps:
      -
        name: Checkout
        uses: actions/checkout@v2
      -
        name: Image build
        uses: docksal/actions/image-build@main

  test:
    name: Build
    runs-on: ubuntu-20.04
    strategy:
      fail-fast: false

    steps:
      -
        name: Checkout
        uses: actions/checkout@v2
      -
        name: Image build
        uses: docksal/actions/image-test@main

  push:
    name: Build
    runs-on: ubuntu-20.04
    strategy:
      fail-fast: false

    steps:
      -
        name: Checkout
        uses: actions/checkout@v2
      -
        name: Image build
        uses: docksal/actions/image-push@main
